<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chatbot Administrativa OGA</title>
  <style>
    body { font-family: Arial; background: #f7f7f7; padding: 20px; }
    #chatbox { max-width: 500px; margin: auto; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px #ccc; }
    .bot, .user { margin: 10px 0; }
    .bot { color: #333; }
    .user { text-align: right; color: #2b6cb0; }
    input[type="text"], select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 10px; padding: 10px; background: #2b6cb0; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px; }
  </style>
</head>
<body>
  <div id="chatbox"></div>
  <script>
    const csvUrl = 'https://raw.githubusercontent.com/uadmoga/chatbot-oga/refs/heads/main/personal.csv';

    const steps = [
      { type: "bot", text: "Buenos días, te comunicaste con el provisto de Administrativa OGA." },
      { type: "bot", text: "Antes de continuar, por favor indicá tu número de legajo.", field: "legajo" },
      { type: "bot", text: "¿En qué podemos ayudarte?", field: "motivo", options: [
        "Solicitar parte médico",
        "Solicitar parte por familiar enfermo",
        "Solicitar aprobación de licencia/trámite en el portal",
        "Otras consultas"
      ]},
      { type: "bot", text: "¿Qué turno cumplís hoy?", field: "turno", options: ["Matutino", "Vespertino"], condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "Ingresá la fecha del parte médico (DD/MM/AAAA)", field: "fecha", condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "Escribí tu número de celular", field: "celular", condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "Domicilio donde estarás durante la licencia (aclarar si es accidental)", field: "domicilio", condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "¿Estás en condiciones de deambular?", field: "deambula", options: ["Sí", "No"], condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "Describí tus síntomas y/o lesiones", field: "sintomas", condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "¿Solicitás ajuste de procedimiento por discapacidad?", field: "ajuste", options: ["No", "Sí"], condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "Por favor describí el ajuste solicitado", field: "ajuste_texto", condition: data => data.ajuste === "Sí" },
      { type: "bot", text: "¿Querés agregar alguna observación?", field: "obs", options: ["No agregar", "Agregar"], condition: data => data.motivo === "Solicitar parte médico" },
      { type: "bot", text: "Escribí la observación", field: "obs_texto", condition: data => data.obs === "Agregar" },
      { type: "bot", text: "Gracias. Tu solicitud fue registrada. Pronto será procesada." }
    ];

    let data = {};
    let stepIndex = 0;
    const box = document.getElementById("chatbox");

    function resetForm() {
      data = {};
      stepIndex = 0;
      nextStep();
    }

    function nextStep() {
      if (stepIndex >= steps.length) return;

      const step = steps[stepIndex];

      box.innerHTML = '';  // Limpia todo el chat (pantalla limpia)
      const message = step.text.replace(/{(\w+)}/g, (_, key) => data[key] || "");
      box.innerHTML += `<div class="bot">${message}</div>`;

      const resetButton = document.createElement("button");
      resetButton.textContent = "Reiniciar formulario";
      resetButton.onclick = resetForm;

      if (step.options) {
        const select = document.createElement("select");
        select.innerHTML = step.options.map(opt => `<option value="${opt}">${opt}</option>`).join("");
        const button = document.createElement("button");
        button.textContent = "Responder";
        button.onclick = () => {
          const value = select.value;
          data[step.field] = value;
          stepIndex++;
          nextStep();
        };
        box.appendChild(select);
        box.appendChild(button);
        box.appendChild(resetButton);
        return;
      }

      if (step.field === "legajo") {
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Ingresá tu legajo...";
        const button = document.createElement("button");
        button.textContent = "Enviar";

        function enviar() {
          const value = input.value;
          data[step.field] = value;
          fetch(csvUrl)
            .then(response => response.text())
            .then(csv => {
              const rows = csv.split('\n').slice(1);
              const agentes = rows.map(row => {
                const [legajo, apellido, nombre] = row.split(',');
                return { legajo: legajo?.trim(), nombre: nombre?.trim() };
              });

              const agente = agentes.find(a => a.legajo === value);
              if (agente) {
                data.nombre = agente.nombre;
                stepIndex++;
                nextStep();
              } else {
                box.innerHTML += `<div class="bot">Legajo no encontrado. Por favor ingresá tu número de legajo que corresponda al personal de OGA Penal Tucumán.</div>`;
                box.appendChild(input);
                box.appendChild(button);
                box.appendChild(resetButton);
              }
            });
        }

        button.onclick = enviar;
        input.addEventListener("keydown", (event) => {
          if (event.key === "Enter") enviar();
        });

        box.appendChild(input);
        box.appendChild(button);
        box.appendChild(resetButton);
        return;
      }

      if (step.field) {
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Escribí aquí...";
        const button = document.createElement("button");
        button.textContent = "Enviar";

        function enviar() {
          const value = input.value;
          data[step.field] = value;
          stepIndex++;
          nextStep();
        }

        button.onclick = enviar;
        input.addEventListener("keydown", (event) => {
          if (event.key === "Enter") enviar();
        });

        box.appendChild(input);
        box.appendChild(button);
        box.appendChild(resetButton);
        return;
      }

      stepIndex++;
      nextStep();
    }

    nextStep();
  </script>
</body>
</html>






